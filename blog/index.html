<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BeerMe Blog</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:'Poppins',sans-serif;background:#f5f7fa;margin:0;padding:2rem;color:#111827}
h1{text-align:center;color:#92400e}
.post{background:#fff;margin:1.5rem auto;padding:1.5rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.06);max-width:800px}
.post h2{margin:0 0 .5rem}
.post small{color:#4b5563}
</style>
</head>
<body>
<h1>üç∫ BeerMe Community Stories</h1>
<div id="posts">Loading‚Ä¶</div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- marked.js for quick Markdown ‚Üí HTML -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
(async () => {
  // ‚ù∂ Get list of files in /blog/ via GitHub API
  const list = await fetch(
      'https://api.github.com/repos/TomMoncrief/beerme.uk/contents/blog'
    ).then(r => r.json());

  const mdFiles = list.filter(f => f.name.endsWith('.md')).reverse(); // newest first
  const container = document.getElementById('posts');
  container.innerHTML = '';

  // ‚ù∑ Loop through each markdown file
  for (const file of mdFiles) {
    const raw = await fetch(file.download_url).then(r => r.text());

    /* --- Parse simple front-matter --- */
    let title = file.name.replace('.md', '');
    let date  = '';
    let body  = raw;

    const fm = /^---([\\s\\S]*?)---/.exec(raw);
    if (fm) {
      fm[1].trim().split(/\\r?\\n/).forEach(line => {
        const [k, v] = line.split(':').map(s => s.trim());
        if (k === 'title') title = v.replace(/^\"|\"$/g, '');
        if (k === 'date')  date  = v;
      });
      body = raw.slice(fm[0].length);            // remove front-matter from body
    }

    const htmlBody = marked.parse(body);

    /* --- Inject into page --- */
    container.insertAdjacentHTML('beforeend', `
      <article class="post">
        <h2>${title}</h2>
        <small>${date}</small>
        <div>${htmlBody}</div>
      </article>
    `);
  }
})();
</script>
</body>
</html>
